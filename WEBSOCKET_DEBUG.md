# WebSocket Debugging Guide

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–ø–∏–Ω–Ω–µ—Ä –Ω–∞ –∫–Ω–æ–ø–∫–µ –∑–∞–ø–∏—Å–∏

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

1. **–ü–µ—Ä–µ–¥–∞—á–∞ API –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä** –≤–º–µ—Å—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
   - –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π WebSocket –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
   - –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `?xi-api-key=...` –≤ URL

2. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - API endpoint –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
   - WebSocket –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —ç—Ç–∞–ø—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –û—à–∏–±–∫–∏ –¥–µ—Ç–∞–ª—å–Ω–æ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ HTTP –æ—Ç–≤–µ—Ç–∞ –æ—Ç API
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Chrome DevTools** (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/dashboard/recordings`
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ (–º–∏–∫—Ä–æ—Ñ–æ–Ω)

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:

```
üîÑ Fetching API key from backend...
‚úÖ API key provided to user: your@email.com
‚úÖ API key received, connecting to WebSocket...
‚úÖ Connected to ElevenLabs Scribe WebSocket
```

### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏:

#### ‚ùå "Unauthorized"
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
**–†–µ—à–µ–Ω–∏–µ:** –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ Google

#### ‚ùå "ELEVENLABS_API_KEY not found"
**–ü—Ä–æ–±–ª–µ–º–∞:** API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ .env.local
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ [.env.local](.env.local#L9) –µ—Å—Ç—å –∫–ª—é—á
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä

#### ‚ùå "Connection closed unexpectedly (code: 1006)"
**–ü—Ä–æ–±–ª–µ–º–∞:** WebSocket –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ ElevenLabs
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é/firewall
- API –∫–ª—é—á –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ Scribe API

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞ –Ω–∞ elevenlabs.io
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Scribe v2
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ DevTools - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å WS –∑–∞–ø—Ä–æ—Å

#### ‚ùå "Failed to connect: HTTP 401/403"
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π API –∫–ª—é—á
**–†–µ—à–µ–Ω–∏–µ:** –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –Ω–∞ elevenlabs.io

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoint

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
```
http://localhost:3000/api/elevenlabs-token
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```json
{"apiKey": "–≤–∞—à_–∫–ª—é—á"}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket –≤ –∫–æ–Ω—Å–æ–ª–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
const ws = new WebSocket('wss://api.elevenlabs.io/v1/speech-to-text/realtime?xi-api-key=YOUR_KEY&model_id=eleven_turbo_v2_5');
ws.onopen = () => console.log('‚úÖ Connected');
ws.onerror = (e) => console.error('‚ùå Error', e);
ws.onmessage = (e) => console.log('üì® Message:', e.data);
```

–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_KEY` –Ω–∞ –≤–∞—à –∫–ª—é—á –∏–∑ .env.local

## üìä Network Tab –ø—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí **Network** tab
2. –§–∏–ª—å—Ç—Ä: **WS** (WebSocket)
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏
4. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å –∫ `api.elevenlabs.io`
5. –°—Ç–∞—Ç—É—Å: **101 Switching Protocols** (—É—Å–ø–µ—Ö)

### –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 401/403:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ elevenlabs.io

### –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª—é—á

## üîß –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å—ã

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env.local **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
# Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run dev
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞
1. DevTools ‚Üí Application ‚Üí Storage
2. Clear site data
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
1. –ê–¥—Ä–µ—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Üí –∏–∫–æ–Ω–∫–∞ –∑–∞–º–∫–∞
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞ ‚Üí –ú–∏–∫—Ä–æ—Ñ–æ–Ω ‚Üí –†–∞–∑—Ä–µ—à–∏—Ç—å

## üìù –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
üîÑ Fetching API key from backend...
‚úÖ API key provided to user: user@example.com
‚úÖ API key received, connecting to WebSocket...
‚úÖ Connected to ElevenLabs Scribe WebSocket
```

### –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```
‚ö†Ô∏è Unauthorized request to /api/elevenlabs-token
‚ùå Failed to connect: Unauthorized
```

### –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```
‚ùå ELEVENLABS_API_KEY not found in environment variables
‚ùå Failed to connect: ElevenLabs API key not configured
```

### –û—à–∏–±–∫–∞ WebSocket:
```
‚ùå WebSocket error: [–æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è]
üîå Disconnected from ElevenLabs { code: 1006, reason: '', wasClean: false }
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –Ω–∞—á–Ω–∏—Ç–µ –≥–æ–≤–æ—Ä–∏—Ç—å
4. –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: Partial transcripts –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

### –°–∏–º–ø—Ç–æ–º—ã:
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã
- –ñ–µ–ª—Ç–æ–µ –æ–∫–Ω–æ "Real-time (partial)" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- –í –∫–æ–Ω—Å–æ–ª–∏ `üü° Partial transcript: undefined`

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
ElevenLabs –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç partial transcripts —Å –ø–æ–ª–µ–º `text`, –∞ –Ω–µ `partial_transcript`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```typescript
case "partial_transcript":
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º message.text –≤–º–µ—Å—Ç–æ message.partial_transcript
  setPartialTranscript(message.text || message.partial_transcript || "");
  break;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
2. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–ø–∏—Å—å –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ
3. –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏: `üü° Partial transcript message: {...}`
4. –í UI –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –∂–µ–ª—Ç–æ–µ –æ–∫–Ω–æ —Å real-time —Ç–µ–∫—Å—Ç–æ–º

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **Partial transcripts** - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏ (–∂–µ–ª—Ç–æ–µ –æ–∫–Ω–æ)
- **Committed transcripts** - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ –ø–∞—É–∑—ã (–∑–µ–ª–µ–Ω–æ–µ –æ–∫–Ω–æ)
- –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ–ª–µ `message.text`

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: WebSocket –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—É–∑—ã

### –°–∏–º–ø—Ç–æ–º—ã:
- –í–∏–¥–∏—Ç–µ `üîå Disconnected from ElevenLabs {code: 1005, reason: '', wasClean: true}`
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—É–∑—ã –≤ —Ä–µ—á–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!

ElevenLabs **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebSocket** –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫:
1. Voice Activity Detection (VAD) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω–µ—Ü —Ä–µ—á–∏
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π `committed_transcript`
3. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–∫–æ–¥ 1000 –∏–ª–∏ 1005)

**–ö–æ–¥—ã –∑–∞–∫—Ä—ã—Ç–∏—è:**
- `1000` = Normal Closure (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
- `1005` = No Status Received (—Ç–∞–∫–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è VAD)

**–†–µ—à–µ–Ω–∏–µ:**
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å exponential backoff. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `commitStrategy: "vad"`.

**–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:**
–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ `manual`:
```typescript
commitStrategy: "manual"
```
–ü—Ä–∏ —ç—Ç–æ–º –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—Ä—É—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å commit —á–µ—Ä–µ–∑ `sendAudioChunk(data, true)`.

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: Next.js Console Error –ø—Ä–∏ WebSocket error

### –°–∏–º–ø—Ç–æ–º—ã:
- –í –∫–æ–Ω—Å–æ–ª–∏ Next.js –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∞—Å–Ω–∞—è –æ—à–∏–±–∫–∞: `‚ùå WebSocket error: {}`
- –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- –ò–ª–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ –≤—Ä–µ–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø–µ—Ä–µ–¥–æ–≤–æ–π –ø–æ–¥—Ö–æ–¥** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ `error` event listener, —Ç–∞–∫ –∫–∞–∫:
1. WebSocket `error` event –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
2. –í—Å–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ `close` event (–∫–æ–¥, –ø—Ä–∏—á–∏–Ω–∞, wasClean)
3. –ü–æ–ø—ã—Ç–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å Event –æ–±—ä–µ–∫—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Next.js

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥:**
```typescript
ws.addEventListener("error", () => {
  // Error event doesn't contain useful info - details come in 'close' event
  // Just update state, NO logging here
  setIsConnected(false);
  setConnectionState("error");
});

ws.addEventListener("close", (event) => {
  // This is where we get actual error details
  const isError = !event.wasClean || (event.code !== 1000 && event.code !== 1005);

  if (isError) {
    console.error("‚ùå WebSocket closed with error", {
      code: event.code,
      reason: event.reason || "No reason provided",
      wasClean: event.wasClean,
    });
  } else {
    console.log("üîå WebSocket closed normally", {
      code: event.code,
      reason: event.reason || "Session ended",
    });
  }
});
```

–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è WebSocket –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º:
```typescript
if (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING) {
  try {
    wsRef.current.close();
  } catch (err) {
    console.warn("WebSocket close error during cleanup:", err);
  }
}
```

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- ElevenLabs Scribe –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 90+ —è–∑—ã–∫–æ–≤
- –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ~150ms
- Voice Activity Detection (VAD) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω–µ—Ü —Ñ—Ä–∞–∑—ã
- API –∫–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –±—Ä–∞—É–∑–µ—Ä–æ–º
- Single-use tokens –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- WebSocket –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ VAD commit (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- WebSocket –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
